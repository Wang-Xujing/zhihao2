<fieldset class="module aligned {{ fieldset.classes }}">
    {% if fieldset.name %}<h2>{{ fieldset.name }}</h2>{% endif %}
    {% if fieldset.description %}
        <div class="description">{{ fieldset.description|safe }}</div>
    {% endif %}
    {% for line in fieldset %}
        <div class="form-row{% if line.fields|length_is:'1' and line.errors %} errors{% endif %}{% if not line.has_visible_field %} hidden{% endif %}{% for field in line %}{% if field.field.name %} field-{{ field.field.name }}{% endif %}{% endfor %}">
            {% if line.fields|length_is:'1' %}{{ line.errors }}{% endif %}
            {% for field in line %}
                <div{% if not line.fields|length_is:'1' %}
                    class="fieldBox{% if field.field.name %} field-{{ field.field.name }}{% endif %}{% if not field.is_readonly and field.errors %} errors{% endif %}{% if field.field.is_hidden %} hidden{% endif %}"{% elif field.is_checkbox %}
                    class="checkbox-row"{% endif %}>
                    {% if not line.fields|length_is:'1' and not field.is_readonly %}{{ field.errors }}{% endif %}

                    {% if field.is_checkbox %}
                        {{ field.field }}{{ field.label_tag }}
                    {% elif field.field.name == "basic_id" and model_name != "e_breed_weaninginfo" %}
                        {% if model_name == "g_slaughter_economicinfo" or model_name == "g_slaughter_slaughtersegmentinfo" or model_name == "g_slaughter_binformationinfo" %}
                            <div>
                                <label for="basic_basicinfo" class="required" style="float: left">电子耳号:</label>
                                {#                            <div style="z-index: 2">#}
                                {#                                <p style="float: left;position: relative;left:0px;display: none" id="p-basic_basicinfo"></p>#}
                                {#                                </div>#}
                                <input type="text" name="basic_basicinfo" class="vTextField" required
                                       id="basic_basicinfo">
                                <input type="number" name="basic_id" style="display: none">
                                <input type="button"
                                       onclick="OpenWin('http://39.99.175.254:8000/basic/basicinfo/page/?state__exact=2')"
                                       value="点击弹出添加弹出框">
                                <input type="button" value="取消选择" onclick='undo("basic_basicinfo")'>
                                <input type="text" id="many-basic_basicinfo" name="many-basic_basicinfo"
                                       hidden="hidden">


                            </div>
                        {% elif model_name == "basic_milkperformance" or model_name == "e_breed_pregnantinfo" %}
                            <div>
                                <label for="basic_basicinfo" class="required" style="float: left">电子耳号:</label>
                                {#                            <div style="z-index: 2">#}
                                {#                                <p style="float: left;position: relative;left:0px;display: none" id="p-basic_basicinfo"></p>#}
                                {#                                </div>#}
                                <input type="text" name="basic_basicinfo" class="vTextField" required
                                       id="basic_basicinfo">


                                <input type="number" name="basic_id" style="display: none">
                                <input type="button"
                                       onclick="OpenWin('http://39.99.175.254:8000/basic/basicinfo/page/?sex__exact=1&state__exact=1')"
                                       value="点击弹出添加弹出框">
                                <input type="button" value="取消选择" onclick='undo("basic_basicinfo")'>
                                <input type="text" id="many-basic_basicinfo" name="many-basic_basicinfo"
                                       hidden="hidden">


                            </div>
                        {% else %}
                            <div>
                                <label for="basic_basicinfo" class="required" style="float: left">电子耳号:</label>
                                {#                            <div style="z-index: 2">#}
                                {#                                <p style="float: left;position: relative;left:0px;display: none" id="p-basic_basicinfo"></p>#}
                                {#                                </div>#}
                                <input type="text" name="basic_basicinfo" class="vTextField" required
                                       id="basic_basicinfo">


                                <input type="number" name="basic_id" style="display: none">
                                <input type="button"
                                       onclick="OpenWin('http://39.99.175.254:8000/basic/basicinfo/page/?state__exact=1')"
                                       value="点击弹出添加弹出框">
                                <input type="button" value="取消选择" onclick='undo("basic_basicinfo")'>
                                <input type="text" id="many-basic_basicinfo" name="many-basic_basicinfo"
                                       hidden="hidden">


                            </div>
                        {% endif %}
                    {% elif field.field.name == "lamb_id" %}
                        <div>
                            <label for="e_breed_lambinfo" class="required" style="float: left">羔羊标识:</label>
                            <input type="text" name="e_breed_lambinfo" class="vTextField" required
                                   id="e_breed_lambinfo">


                            <input type="number" name="lamb_id" style="display: none">
                            <input type="button" onclick="OpenWin('http://39.99.175.254:8000/e_breed/lambinfo/page/')"
                                   value="点击弹出添加弹出框">
                            <input type="button" value="取消选择" onclick='undo("e_breed_lambinfo")'>
                            <input type="text" id="many-e_breed_lambinfo" name="many-e_breed_lambinfo" hidden="hidden">


                        </div>

                    {% elif field.field.name == "belong" and model_name != "account_myuser"%}
                        <div>
                            <input type="number" name="belong" style="display: none">
                        </div>
                    {% elif field.field.name == "f_staff" %}
                        <div>
                            <input type="number" name="f_staff" style="display: none">
                        </div>
                    {% elif field.field.name == "house_id" %}
                        <div>
                            <label for="colony_houseinfo" class="required" style="float: left">圈舍:</label>
                            {#                            <div style="z-index: 2">#}
                            {#                                <p style="float: left;position: relative;left:0px;display: none" id="p-basic_basicinfo"></p>#}
                            {#                                </div>#}
                            <input type="text" name="colony_houseinfo" class="vTextField" required
                                   id="colony_houseinfo">


                            <input type="number" name="house_id" style="display: none">
                            <input type="button" onclick="OpenWin('http://39.99.175.254:8000/colony/houseinfo/page/')"
                                   value="点击弹出添加弹出框">
                            <input type="button" value="取消选择" onclick='undo("colony_houseinfo")'>
                            <input type="text" id="many-colony_houseinfo" name="many-colony_houseinfo" hidden="hidden">


                        </div>
                    {% elif field.field.name == "vaccine_id" %}
                        <div>
                            <label for="supply_commodityinfo" style="float: left">疫苗信息:</label>
                            {#                            <div style="z-index: 2">#}
                            {#                                <p style="float: left;position: relative;left:0px;display: none" id="p-basic_basicinfo"></p>#}
                            {#                                </div>#}
                            <input type="text" name="supply_commodityinfo" class="vTextField" required
                                   id="supply_commodityinfo">


                            <input type="number" name="vaccine_id" style="display: none">
                            <input type="button"
                                   onclick="OpenWin('http://39.99.175.254:8000/supply/commodityinfo/page/?type__exact=0')"
                                   value="点击弹出添加弹出框">
                            <input type="button" value="取消选择" onclick='undo("supply_commodityinfo")'>
                            <input type="text" id="many-supply_commodityinfo" name="many-supply_commodityinfo"
                                   hidden="hidden">
                        </div>
                    {% elif field.field.name == "drug_id" %}
                        <div>
                            <label for="supply_commodityinfo" style="float: left">药物信息:</label>
                            {#                            <div style="z-index: 2">#}
                            {#                                <p style="float: left;position: relative;left:0px;display: none" id="p-basic_basicinfo"></p>#}
                            {#                                </div>#}
                            <input type="text" name="supply_commodityinfo" class="vTextField" required
                                   id="supply_commodityinfo">


                            <input type="number" name="drug_id" style="display: none">
                            <input type="button"
                                   onclick="OpenWin('http://39.99.175.254:8000/supply/commodityinfo/page/?type__exact=1')"
                                   value="点击弹出添加弹出框">
                            <input type="button" value="取消选择" onclick='undo("supply_commodityinfo")'>
                            <input type="text" id="many-supply_commodityinfo" name="many-supply_commodityinfo"
                                   hidden="hidden">
                        </div>
                    {% elif field.field.name == "maker_id" %}
                        {% if 'h_store' in model_name and object_id == None%}
                            <div style="color: red">注意！物资名称、物资类型、厂家信息，提交后不能修改</div>

                        {% endif %}
                        {% if model_name == "h_store_feedingin" or model_name == "h_store_feeding_out" %}
                            <div>
                                <label for="supply_f_suppliersinfo" style="float: left">厂家:</label>
                                <input type="text" name="supply_f_suppliersinfo" class="vTextField" required
                                       id="supply_f_suppliersinfo">
                                <input type="number" name="maker_id" style="display: none">
                                <input type="button"
                                       onclick="OpenWin('http://39.99.175.254:8000/supply/f_suppliersinfo/page/')"
                                       value="点击弹出添加弹出框">
                                <input type="button" value="取消选择" onclick='undo("supply_f_suppliersinfo")'>
                                <input type="text" id="many-supply_f_suppliersinfo" name="many-supply_f_suppliersinfo"
                                       hidden="hidden">
                            </div>
                        {% else %}
                            <div>
                                <label for="supply_v_suppliersinfo" style="float: left">厂家:</label>
                                <input type="text" name="supply_v_suppliersinfo" class="vTextField" required
                                       id="supply_v_suppliersinfo">
                                <input type="number" name="maker_id" style="display: none">
                                <input type="button"
                                       onclick="OpenWin('http://39.99.175.254:8000/supply/v_suppliersinfo/page/')"
                                       value="点击弹出添加弹出框">
                                <input type="button" value="取消选择" onclick='undo("supply_v_suppliersinfo")'>
                                <input type="text" id="many-supply_v_suppliersinfo" name="many-supply_v_suppliersinfo"
                                       hidden="hidden">
                            </div>
                        {% endif %}

                    {% elif field.field.name == "vac_maker" %}
                        <div>
                            <label for="supply_v_suppliersinfo" style="float: left">生产厂家:</label>
                            <input type="text" name="supply_v_suppliersinfo" class="vTextField" required
                                   id="supply_v_suppliersinfo">


                            <input type="number" name="vac_maker" style="display: none">
                            <input type="button"
                                   onclick="OpenWin('http://39.99.175.254:8000/supply/v_suppliersinfo/page/')"
                                   value="点击弹出添加弹出框">
                            <input type="button" value="取消选择" onclick='undo("supply_v_suppliersinfo")'>
                            <input type="text" id="many-supply_v_suppliersinfo" name="many-supply_v_suppliersinfo"
                                   hidden="hidden">
                        </div>
                    {% elif field.field.name == "breeding_id" %}
                        <div>
                            <label for="e_breed_breedinginfo" style="float: left">配种信息:</label>
                            <input type="text" name="e_breed_breedinginfo" class="vTextField" required
                                   id="e_breed_breedinginfo">


                            <input type="number" name="breeding_id" style="display: none">
                            <input type="button"
                                   onclick="OpenWin('http://39.99.175.254:8000/e_breed/breedinginfo/page/')"
                                   value="点击弹出添加弹出框">
                            <input type="button" value="取消选择" onclick='undo("e_breed_breedinginfo")'>
                            <input type="text" id="many-e_breed_breedinginfo" name="many-e_breed_breedinginfo"
                                   hidden="hidden">
                        </div>

                    {% else %}
                        {{ field.label_tag }}
                        {% if field.is_readonly %}
                            <div class="readonly">{{ field.contents }}</div>
                        {% else %}
                            {{ field.field }}

                        {% endif %}
                    {% endif %}
                    {% if field.field.help_text %}
                        <div class="help">{{ field.field.help_text|safe }}</div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    {% endfor %}

</fieldset>

<!--<script type="text/javascript" src="/static/admin/js/image_pro.js"></script>-->
<!--<script type="text/javascript" src="/static/admin/js/imagePreview.js"></script>-->
<script type="text/javascript">


    /**
     * Created by hucf on 2019/11/20.
     */
    var ImagePreview = {
        default_params: {},
        init: function (param) {
            if (param) {
                $.extend(this.default_params, param);
            }
            ip_global_img_list = [];
            var id = this.default_params.id;
            if (typeof id == 'string') {
                if ((ip_global_img_list = $("#" + id).find("img")).length == 0) {
                    return;
                }
            } else if (typeof id == 'object' && id != null) {
                ip_global_img_list = $(id);
            }
            this.fnGenerateHtml();
            this.fnBindEvent(ip_global_img_list);
        },
        fnBindEvent: function (ip_global_img_list) {
            if (ip_global_img_list.length == 0) {
                return;
            }
            $(ip_global_img_list).on("click", this.onClickEvent);
            this.onDragEvent($("#ip-img-preview"));
            $("#ip-img-preview").on('mousewheel DOMMouseScroll', this.onMouseScrollEvent);

            $('#ip-img-floatshadow').on("click", function () {
                $('#ip-img-preview').hide();
                $("#ip-left").hide();
                $("#ip-right").hide();
                $('#ip-img-floatshadow').hide();
                $('#ip-img-preview').attr("src", "");
            });
            $("#ip-left").hover(this.fnMouseOver, this.fnMouseOut).click(this.fnPrev);
            $("#ip-right").hover(this.fnMouseOver, this.fnMouseOut).click(this.fnNext);
        },
        fnGenerateHtml: function () {
            $("body").append('<img id="ip-img-preview" style="position: fixed;left: 50%;top: 50%;transform: translate(-50%, -50%);z-index: 19941206;cursor: move;display: none"/><div id="ip-img-floatshadow" style="z-index: 19941205;background-color: #000;opacity: .5;top: 0;left: 0;width: 100%;height: 100%;position: fixed;display: none" title="点击空白处关闭"></div>');
            $("body").append('<div id="ip-left" style="display: none; width: 100px; height: 100px;left: 5px; top: 50%; position:fixed;z-index:19941207; cursor: pointer;">' +
                '<div style="left:-30px;border: 50px solid;border-color: transparent #1CB9C4 transparent transparent;position: absolute;"></div></div>');
            $("body").append('<div id="ip-right" style="display: none; width: 100px; height: 100px; right: 5px; top: 50%; position:fixed; z-index:19941207;cursor: pointer;">' +
                '<div style="left:30px;border: 50px solid;border-color: transparent transparent transparent #1CB9C4;position: absolute;"></div></div>');
        },
        fnMouseOver: function () {
            $(this).css("background", "rgb(134, 134, 134)");
            $(this).css("border", "1px solid rgb(111, 111, 111)");
        },
        fnMouseOut: function () {
            $(this).css("background", "");
            $(this).css("border", "");
        },
        fnPrev: function () {
            if (typeof (ip_global_cur) == "number" && ip_global_cur > 0) {
                ImagePreview.fnReset();
                $("#ip-img-preview").animate({left: "48%"}, 100);
                $("#ip-img-preview").attr("src", ip_global_img_list[--ip_global_cur].src);
                $("#ip-img-preview").animate({left: "50.5%"}, 100);
                $("#ip-img-preview").animate({left: "50%"}, 100);
                ImagePreview.fnAdjustMaxWidth();
            }
        },
        fnNext: function () {
            if (typeof (ip_global_cur) == "number" && ip_global_cur < ip_global_img_list.length - 1) {
                ImagePreview.fnReset();
                $("#ip-img-preview").animate({left: "52%"}, 100);
                $("#ip-img-preview").attr("src", ip_global_img_list[++ip_global_cur].src);
                $("#ip-img-preview").animate({left: "49.5%"}, 100);
                $("#ip-img-preview").animate({left: "50%"}, 100);
                ImagePreview.fnAdjustMaxWidth();
            }
        },
        fnGetIndexOfCurImg: function (cur) {
            for (var i = 0; i < ip_global_img_list.length; i++) {
                if ($(ip_global_img_list[i]).is(cur)) {
                    return i;
                }
            }
        },
        onClickEvent: function (e) {
            ImagePreview.fnReset();
            $("#ip-img-preview").attr("src", $(this).attr("src"));
            ImagePreview.fnAdjustMaxWidth();
            ip_global_cur = ImagePreview.fnGetIndexOfCurImg($(this));
            $("#ip-img-floatshadow").fadeIn();
            $("#ip-img-preview").fadeIn();
            $("#ip-left").fadeIn();
            $("#ip-right").fadeIn();
        },
        fnAdjustMaxWidth: function () {
            //最长边判定，避免超出屏幕画幅的展示
            var widthFlag = true;
            var max = $("#ip-img-preview").width();
            if (max < $("#ip-img-preview").height()) {
                widthFlag = false;
                max = $("#ip-img-preview").height();
            }
            if (widthFlag && $(window).width() < max) {
                $("#ip-img-preview").css("width", "75%");
            } else if (!widthFlag && $(window).height() < max) {
                $("#ip-img-preview").css("height", "75%");
            }
        },
        fnReset: function () {
            $("#ip-img-preview").css("left", "50%");
            $("#ip-img-preview").css("top", "50%");
            $("#ip-img-preview").css("width", "");
            $("#ip-img-preview").css("height", "");
        },
        onMouseScrollEvent: function (e) {
            e.preventDefault();
            var wheel = e.originalEvent.wheelDelta || -e.originalEvent.detail;
            var delta = Math.max(-1, Math.min(1, wheel));
            if (delta < 0) { //向下滚动
                $(this).width($(this).width() / 1.1);
                $(this).height($(this).height() / 1.1);
            } else { //向上滚动
                $(this).width($(this).width() * 1.1);
                $(this).height($(this).height() * 1.1);
            }
        },
        onDragEvent: function (obj) {
            obj.bind("mousedown", start);

            function start(event) {
                if (event.button == 0) {
                    gapX = event.clientX - obj.offset().left;
                    gapY = event.clientY - obj.offset().top;
                    $(document).bind("mousemove", move);
                    $(document).bind("mouseup", stop);
                }
                return false;
            }

            function move(event) {
                obj.css({
                    "left": (event.clientX - gapX + obj.width() / 2) + "px",
                    "top": (event.clientY - gapY + obj.height() / 2) + "px"
                });
                return false;
            }

            function stop() {
                $(document).unbind("mousemove", move);
                $(document).unbind("mouseup", stop);
            }
        }
    };


    var image_document = document.getElementsByTagName("a");
    for (var i = 0; i < image_document.length; i++) {
        let text_list = image_document[i].href.split('.')
        console.log("text_list", text_list)
        let image_list = ["jpg", "png"]
        for (let j = 0; j < image_list.length; j++) {
            console.log("image_list[i]-====", image_list[j])
            console.log("text_list[text_list.length-1]===", text_list[text_list.length - 1])
            if (text_list[text_list.length - 1] == image_list[j]) {
                console.log("oho=====")
                var herf = image_document[i].href
                console.log(herf)
                var image_html = image_document[i].outerHTML
                image_document[i].outerHTML = '<div id="imgBox"><img style="width: 200px" id="img" src="' + herf + '"/></div>'
            }
        }
    }
    // ImagePreview.init({id:"imgBox"});
    ImagePreview.init({id: $("#imgBox img")});


</script>


<style type="text/css">
    #imgs img {
        width: 24%;
    }
</style>